<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="container-fluid pl-md-5">
        <app-card-header-information style="width: 100%;" [cardData]="cardDataHeader"
          (rangeChange)="updateChart($event, cardDataTypeEnumLocal.Header)">
        </app-card-header-information>
      </div>
    </div>
  </div>
  <br>

  <div class="row mt-5">
    <div class="col-12">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12 col-md-6 col-lg-5 offset-lg-1">
            <app-chart-card-small (rangeChange)="updateChart($event, cardDataTypeEnumLocal.Sessions)"
              [cardData]="cardDataSessions">
            </app-chart-card-small>
          </div>
          <div class="col-12 col-md-6 col-lg-5 offset-12 offset-md-6 offset-lg-6 special-col">
            <div class="card fixed-max-height">
              <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                  <h4 class="card-title mb-3">Área de atuação</h4>
                  <app-loader *ngIf="loadingOccupationArea" color="purple" style="margin-left: 10px;" size="25px">
                  </app-loader>
                </div>
                <form *ngIf="!loadingOccupationArea" [formGroup]="occupationAreaForm"
                  class="theme-form mb-3 billing-form d-flex justify-content-between w-100 flex-wrap flex-lg-nowrap">
                  <div class="form-group flex-grow-lg-1 pr-lg-3 w-100">
                    <input class="form-control" type="text" formControlName="name"
                      placeholder="Adiciona um nova Área de atuação" autocomplete="off" />
                  </div>
                  <div class="form-group">
                    <button class="btn btn-primary" [disabled]="occupationAreaForm.status == 'INVALID'"
                      (click)="addOccupationArea()">Adicionar</button>
                  </div>
                </form>
                <div class="d-flex  flex-column area-list">
                  <div *ngFor="let occupationArea of OccupationAreaList; index as i"
                    class="d-flex align-items-center justify-content-between area-item px-3">
                    <div class="d-flex align-items-center">
                      <p class="my-0 mr-3">{{ i + 1 }}</p>
                      <p>{{ occupationArea.name }}</p>
                    </div>
                    <i *ngIf="occupationArea.isDeletable" class="icon-close" style="color: red; cursor: pointer;"
                      (click)="openModalDeleteOccupationArea(occupationArea)"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container-fluid mt-3">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-body overflow-hidden">
            <div class="d-flex justify-content-between mb-3">
              <p class="title-professionals-table">Profissionais</p>
              <div class="input-group mb-3 w-25 ">
                <input type="text" class="form-control digits border-right-0" (keyup)="updateFilter($event)" />
                <div class="input-group-append">
                  <span class="input-group-text search-icon" id="basic-addon2">
                    <i class="icofont icofont-search-alt-2"></i>
                  </span>
                </div>
              </div>
            </div>
            <div class="d-flex border-tabs">
              <div class="pb-2 subtitle-professionals-table" *ngFor="let tab of tabHeaders"
                (click)="activeTabChanged(tab)" [ngClass]="{ active: tab.active }">
                {{ tab.description }} ({{ tab.counter }})
              </div>
            </div>
            <div class="row">
              <app-loader *ngIf="isLoadingProfessionals" color="purple"
                style="margin-left: auto; margin-right: auto; margin-top: 20px;" size="25px">
              </app-loader>
              <div class="col-12 d-flex align-items-center justify-content-center text-center"
                *ngIf="!isLoadingProfessionals && !professionalList[0]">
                <h2 class="dark-gray my-5">Nenhum profissional encontrado</h2>
              </div>
              <div class="table-responsive">
                <table mdbTable [striped]="mdbTableStriped" *ngIf="!isLoadingProfessionals && professionalList[0]">
                  <thead>
                    <tr>
                      <th class="title-head cursor-pointer table-header" *ngFor="let head of headElements" scope="col"
                        (click)="orderTableByHead(head.type)">
                        <div class="d-flex flex-row">
                          {{ (head.visible) ? head.description : '' }}
                          <div *ngIf="head.visible" [innerHTML]="head.icon" style="margin-left: 5px;"></div>
                        </div>
                      </th>
                    </tr>
                  </thead>
                  <tbody mdbTableCol
                    *ngFor="let professional of professionalList | paginate: { itemsPerPage: 10, currentPage: paginaAtual }; let i = index">
                    <tr>
                      <td class="detail-text">{{ professional.creationDate }}</td>
                      <td class="detail-text">{{ professional.name }}</td>
                      <td>
                        <div *ngIf="selectedTab == evaluationStatusEnum.All"
                          class="d-inline-flex justify-content-around align-items-center pr-2 btn-ci rounded-border"
                          style="color:white; height: 30px;"
                          [style.background-color]="professionalHelper.getEvaluationStatusColorStamp(professional.evaluationStatus)">
                          <span class="mr-2 ml-2"> {{ professional.status }} </span>
                        </div>
                      </td>
                      <td scope="row">
                        <p class="text-purple detail-btn text-right cursor-pointer" mdbWavesEffect
                          (click)="details(professional)">
                          Detalhes
                          <i class="icofont icofont-simple-up" *ngIf="professional.collapsed"></i>
                          <i class="icofont icofont-simple-down" *ngIf="!professional.collapsed"></i>
                        </p>
                      </td>
                    </tr>
                    <tr *ngIf="professional.collapsed"
                      style="text-align: center; background-color: rgba(0, 0, 0, 0.015)">
                      <td colspan="100%" style="border: 0 !important">
                        <div class="d-flex flex-column">
                          <h3 class="dark-text detail-name">{{ professional.name }}</h3>
                          <div class="d-flex justify-content-between gray-text text-left">
                            <div class="d-flex flex-column align-items-start w-25 p-3">
                              <p>{{ professional.phoneNumber | phone }}</p>
                              <p>{{ professional.email }}</p>
                              <h4 class="dark-text">Apresentação</h4>
                              <p class="font-italic">"{{ professional.presentation }}"</p>
                            </div>

                            <div class="d-flex w-50 p-3">
                              <div class="d-flex flex-column w-50 pr-2">
                                <h4 class="dark-text">Resumo</h4>
                                <p class="subtitle-text">Formação</p>
                                <p>{{ professional.formation }}</p>
                                <p class="subtitle-text">Tempo de experiência</p>
                                <p>{{ getExperienceTimeText(professional.experienceTime) }}</p>
                                <p class="subtitle-text">Média de atendimentos</p>
                                <p>{{ getTotalAssistanceText(professional.totalAssistance) }}</p>
                                <p class="subtitle-text">
                                  Valor cobrado por atendimento
                                </p>
                                <p>
                                  {{ (!professional?.selectedPriceLevel) ? (professional.averageAssistanceValue |
                                  currency:
                                  'BRL':true) :
                                  professional?.selectedPriceLevel.name }}
                                </p>
                              </div>
                              <div class="d-flex flex-column w-50">
                                <p class="subtitle-text">Áreas de atuação</p>
                                <p *ngFor="let occupationArea of professional.occupationAreas">{{ occupationArea }}</p>
                                <p class="subtitle-text">
                                  Especializações
                                </p>
                                <p *ngFor="let specialization of professional.specializations">
                                  {{ specialization }}
                                </p>
                              </div>
                            </div>
                            <div class="w-25 d-flex justify-content-center"
                              [ngClass]="{ hidden: professionalTableTabRegister }">
                              <div class="d-flex flex-column align-items-start p-3">
                                <p class="subtitle-text">Documentos</p>
                                <button class="btn btn-outline-gray text-purple mb-5 w-100"
                                  (click)="openDocumentsModal(professional.id)">Ver documentos</button>
                                <div *ngIf="professional.evaluationStatus == evaluationStatusEnum.PendingEvaluation">
                                  <p class="subtitle-text">Aprovar?</p>
                                  <div class="d-flex justify-content-between">
                                    <button class="btn btn-outline bg-green text-white mr-2"
                                      (click)="openModalToApprove(professional)">
                                      Aprovar
                                    </button>
                                    <button class="btn btn-outline bg-red text-white ml-2"
                                      (click)="openModalToReject(professional)">
                                      Rejeitar
                                    </button>
                                  </div>
                                </div>
                                <p class="subtitle-text"
                                  *ngIf="professional.evaluationStatus != evaluationStatusEnum.PendingEvaluation && professional.evaluationStatus != evaluationStatusEnum.PendingStripeRegister && professional.evaluationStatus != evaluationStatusEnum.Rejected">
                                  Níveis</p>
                                <div class="d-flex flex-column justify-content-between"
                                  *ngIf="professional.evaluationStatus != evaluationStatusEnum.PendingEvaluation && professional.evaluationStatus != evaluationStatusEnum.PendingStripeAssociationId && professional.evaluationStatus != evaluationStatusEnum.Active">
                                  <div *ngFor="let price of professional.priceLevels"
                                    [ngClass]="{'primary-text': (professional.selectedPriceLevel && professional.selectedPriceLevel.name == price.name)}"
                                    [style.font-size]="(professional.selectedPriceLevel && professional.selectedPriceLevel.name == price.name) ? '16px' : '14px'">
                                    {{ price.name }}
                                  </div>
                                </div>

                                <div class="d-flex flex-column justify-content-between w-100">
                                  <div style="width: 336px;"
                                    *ngIf="professional.evaluationStatus == evaluationStatusEnum.PendingStripeAssociationId || professional.evaluationStatus == evaluationStatusEnum.Active">
                                    <ng-multiselect-dropdown [id]="professional.id" [placeholder]="'Selecione Níveis'"
                                      [settings]="dropdownSettings" [data]="priceLevelList"
                                      [(ngModel)]="professional.priceLevels"
                                      (onSelect)="checkPriceLevelSelectLimit(professional)"
                                      [disabled]="professional.evaluationDate && !professional.approvalDate">
                                    </ng-multiselect-dropdown>
                                    <div class="input-error-wrapper">
                                      <div *ngIf="professional.priceLevels && professional.priceLevels.length > 3"
                                        class="text text-danger mt-1">
                                        Máximo de 3 níveis
                                      </div>
                                    </div>
                                  </div>
                                  <br>
                                  <div class="w-100"
                                    *ngIf="professional.evaluationStatus == evaluationStatusEnum.Active ">
                                    <button class="btn btn-outline bg-blue text-white w-100"
                                      (click)="saveStripeIDOrPriceLevels(professional)"
                                      [disabled]="priceLevesIsOK(professional)">
                                      Salvar
                                    </button>
                                  </div>
                                  <div class="w-100"
                                    *ngIf="professional.evaluationStatus == evaluationStatusEnum.PendingStripeAssociationId">
                                    <p class="subtitle-text">Stripe ID</p>
                                    <p>
                                      <input class="form-control" type="text" [(ngModel)]="professional.stripeId"
                                        #ctrl="ngModel" required placeholder="Informar Stripe ID " autocomplete="off" />
                                    </p>
                                    <button class="btn btn-outline bg-blue text-white w-100"
                                      (click)="saveStripeIDOrPriceLevels(professional)"
                                      [disabled]="!professional.stripeId || professional.priceLevels.length < 3">
                                      Salvar
                                    </button>
                                  </div>
                                  <div class="d-flex flex-column justify-content-between w-100"
                                    *ngIf="professional.evaluationStatus == evaluationStatusEnum.PendingStripeRegister">
                                    <p class="subtitle-text">Link Stripe</p>
                                    <p>
                                      <input class="form-control" type="text" [(ngModel)]="professional.stripeInvite"
                                        #ctrl="ngModel" required placeholder="Informar link Stripe "
                                        autocomplete="off" />
                                    </p>
                                    <button class="btn btn-outline bg-blue text-white" [disabled]="ctrl.invalid"
                                      (click)="saveStripeCode(professional)">
                                      Enviar
                                    </button>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                  <tbody>
                    <tr>
                      <td colspan="4" class="text-center pb-0">
                        <pagination-controls (pageChange)="paginaAtual = $event"></pagination-controls>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>